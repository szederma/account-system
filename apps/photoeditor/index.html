<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Editor Pro+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            --primary-color: #6366f1; /* indigo-500 */
            --primary-hover: #4f46e5; /* indigo-600 */
            --dark-bg: #111827; /* gray-900 */
            --medium-bg: #1f2937; /* gray-800 */
            --light-bg: #374151; /* gray-700 */
            --text-color: #d1d5db; /* gray-300 */
            --text-light: #9ca3af; /* gray-400 */
            --border-color: #4b5563; /* gray-600 */
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--medium-bg); }
        ::-webkit-scrollbar-thumb { background: var(--light-bg); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        /* Custom Slider Styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: var(--light-bg);
            border-radius: 2px;
            outline: none;
            transition: opacity .2s;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary-color);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--dark-bg);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--primary-color);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--dark-bg);
        }

        /* Buttons & Interactivity */
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--primary-hover);
        }
        .btn-secondary {
            background-color: var(--light-bg);
            color: white;
        }
        .btn-secondary:hover {
            background-color: var(--border-color);
        }
        
        /* Accordion for controls */
        .accordion-header { cursor: pointer; }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        /* Vignette effect */
        #vignette-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border-radius: 0.5rem; /* match canvas radius */
            box-shadow: inset 0 0 0px rgba(0,0,0,0);
            transition: box-shadow 0.3s ease;
        }

        /* Responsive layout */
        @media (max-width: 768px) {
            #controls-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 50vh;
                transform: translateY(100%);
                transition: transform 0.3s ease-in-out;
                z-index: 40;
                border-top: 1px solid var(--border-color);
            }
            #controls-panel.open {
                transform: translateY(0);
            }
            #main-content {
                padding-bottom: 60px; /* Space for the collapsed controls handle */
            }
        }
    </style>
</head>
<body class="bg-dark-bg text-text-color flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header class="bg-medium-bg/80 backdrop-blur-sm border-b border-border-color p-3 shadow-lg z-20 flex-shrink-0">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-white">Photo Editor Pro+</h1>
            <div class="flex items-center space-x-3">
                <button id="reset-btn" class="btn btn-secondary text-sm font-medium py-2 px-4 rounded-lg flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.496 6.504a9 9 0 11-12.992 0" /></svg>
                    <span>Reset</span>
                </button>
                <button id="download-btn" class="btn btn-primary text-sm font-medium py-2 px-4 rounded-lg flex items-center space-x-2">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                    <span>Download</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div id="main-content" class="flex-grow flex flex-col md:flex-row overflow-hidden">
        <!-- Controls Panel -->
        <aside id="controls-panel" class="w-full md:w-80 lg:w-96 bg-medium-bg p-1 md:p-4 overflow-y-auto">
             <div class="md:hidden p-2 text-center bg-light-bg" id="mobile-controls-handle">
                <span class="font-semibold">Editing Controls</span>
            </div>
            <div class="space-y-4 p-3">
                <!-- File Upload -->
                <div>
                     <label for="file-input" class="w-full btn btn-primary py-3 px-4 rounded-lg cursor-pointer text-center font-semibold flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                        <span>Upload Image</span>
                    </label>
                    <input type="file" id="file-input" accept="image/*" class="hidden">
                </div>

                <div id="editor-controls" class="hidden space-y-2">
                    <!-- Light Adjustments -->
                    <div class="accordion-item bg-dark-bg rounded-lg">
                        <div class="accordion-header flex justify-between items-center p-3">
                            <h3 class="font-semibold text-lg">Light</h3>
                            <svg class="w-6 h-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </div>
                        <div class="accordion-content p-4 space-y-4 border-t border-border-color">
                           <div class="control-wrap"><label>Exposure</label><input type="range" id="light-exposure" min="0" max="200" value="100"><span id="light-exposure-value">100%</span></div>
                            <div class="control-wrap"><label>Brightness</label><input type="range" id="light-brightness" min="0" max="200" value="100"><span id="light-brightness-value">100%</span></div>
                            <div class="control-wrap"><label>Contrast</label><input type="range" id="light-contrast" min="0" max="200" value="100"><span id="light-contrast-value">100%</span></div>
                        </div>
                    </div>
                    <!-- Color Adjustments -->
                    <div class="accordion-item bg-dark-bg rounded-lg">
                        <div class="accordion-header flex justify-between items-center p-3">
                            <h3 class="font-semibold text-lg">Color</h3>
                             <svg class="w-6 h-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </div>
                        <div class="accordion-content p-4 space-y-4 border-t border-border-color">
                             <div class="control-wrap"><label>Temperature</label><input type="range" id="color-temperature" min="-100" max="100" value="0"><span id="color-temperature-value">0</span></div>
                             <div class="control-wrap"><label>Tint</label><input type="range" id="color-tint" min="-100" max="100" value="0"><span id="color-tint-value">0</span></div>
                             <div class="control-wrap"><label>Vibrance</label><input type="range" id="color-vibrance" min="0" max="200" value="100"><span id="color-vibrance-value">100%</span></div>
                             <div class="control-wrap"><label>Saturation</label><input type="range" id="color-saturation" min="0" max="200" value="100"><span id="color-saturation-value">100%</span></div>
                        </div>
                    </div>
                    <!-- Effects -->
                     <div class="accordion-item bg-dark-bg rounded-lg">
                        <div class="accordion-header flex justify-between items-center p-3">
                            <h3 class="font-semibold text-lg">Effects</h3>
                             <svg class="w-6 h-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </div>
                        <div class="accordion-content p-4 space-y-4 border-t border-border-color">
                             <div class="control-wrap"><label>Clarity</label><input type="range" id="effects-clarity" min="0" max="100" value="0"><span id="effects-clarity-value">0</span></div>
                             <div class="control-wrap"><label>Blur</label><input type="range" id="effects-blur" min="0" max="20" value="0" step="0.1"><span id="effects-blur-value">0px</span></div>
                             <div class="control-wrap"><label>Vignette</label><input type="range" id="effects-vignette" min="0" max="100" value="0"><span id="effects-vignette-value">0</span></div>
                        </div>
                    </div>
                    <!-- Transformations & Filters -->
                     <div class="accordion-item bg-dark-bg rounded-lg">
                        <div class="accordion-header flex justify-between items-center p-3">
                            <h3 class="font-semibold text-lg">More</h3>
                             <svg class="w-6 h-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </div>
                        <div class="accordion-content p-4 space-y-4 border-t border-border-color">
                            <div class="grid grid-cols-2 gap-3">
                                <button id="rotate-left-btn" class="btn btn-secondary p-2 rounded-md">Rotate Left</button>
                                <button id="rotate-right-btn" class="btn btn-secondary p-2 rounded-md">Rotate Right</button>
                                <button id="flip-horizontal-btn" class="btn btn-secondary p-2 rounded-md">Flip H</button>
                                <button id="flip-vertical-btn" class="btn btn-secondary p-2 rounded-md">Flip V</button>
                            </div>
                             <div class="grid grid-cols-3 gap-2 pt-4">
                                <button class="filter-btn btn btn-secondary text-xs p-2 rounded-md" data-filter="none">None</button>
                                <button class="filter-btn btn btn-secondary text-xs p-2 rounded-md" data-filter="grayscale">Grayscale</button>
                                <button class="filter-btn btn btn-secondary text-xs p-2 rounded-md" data-filter="sepia">Sepia</button>
                                <button class="filter-btn btn btn-secondary text-xs p-2 rounded-md" data-filter="invert">Invert</button>
                                <button class="filter-btn btn btn-secondary text-xs p-2 rounded-md" data-filter="vintage">Vintage</button>
                                <button class="filter-btn btn btn-secondary text-xs p-2 rounded-md" data-filter="lomo">Lomo</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Canvas Area -->
        <main class="flex-grow bg-dark-bg flex items-center justify-center p-4 overflow-hidden relative">
            <div id="placeholder" class="text-center text-text-light">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-24 w-24" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                <p class="mt-4 text-lg font-semibold">Upload an image to start editing</p>
                <p class="text-sm">Works best with JPG, PNG, WEBP</p>
            </div>
            <div class="relative w-full h-full flex items-center justify-center">
                <canvas id="canvas" class="hidden max-w-full max-h-full rounded-lg shadow-2xl"></canvas>
                <div id="vignette-overlay"></div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const fileInput = document.getElementById('file-input');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            const placeholder = document.getElementById('placeholder');
            const editorControls = document.getElementById('editor-controls');
            const vignetteOverlay = document.getElementById('vignette-overlay');
            const controlsPanel = document.getElementById('controls-panel');
            const mobileControlsHandle = document.getElementById('mobile-controls-handle');

            // --- State Management ---
            let image = null;
            let originalImagePixels = null;
            
            const defaultState = {
                light: { exposure: 100, brightness: 100, contrast: 100 },
                color: { temperature: 0, tint: 0, vibrance: 100, saturation: 100 },
                effects: { clarity: 0, blur: 0, vignette: 0 },
                transform: { rotation: 0, flipH: 1, flipV: 1 },
                filter: 'none'
            };
            let state = JSON.parse(JSON.stringify(defaultState));
            
            // --- UI Setup & Event Listeners ---
            
            // Accordion functionality
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('svg');
                    const item = header.parentElement;

                    item.parentElement.querySelectorAll('.accordion-content').forEach(otherContent => {
                        if (otherContent !== content) {
                            otherContent.style.maxHeight = null;
                            otherContent.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
                        }
                    });

                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        icon.classList.remove('rotate-180');
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        icon.classList.add('rotate-180');
                    }
                });
            });
            
            // Mobile controls toggle
            if (mobileControlsHandle) {
                mobileControlsHandle.addEventListener('click', () => {
                    controlsPanel.classList.toggle('open');
                });
            }

            // File Upload
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    image = new Image();
                    image.onload = () => {
                        placeholder.classList.add('hidden');
                        canvas.classList.remove('hidden');
                        editorControls.classList.remove('hidden');
                        document.getElementById('reset-btn').disabled = false;
                        document.getElementById('download-btn').disabled = false;
                        if(window.innerWidth <= 768) {
                           controlsPanel.classList.add('open');
                        }
                        
                        resetState();
                        // Get original pixel data once
                        const tempCanvas = document.createElement('canvas');
                        const tempCtx = tempCanvas.getContext('2d');
                        tempCanvas.width = image.width;
                        tempCanvas.height = image.height;
                        tempCtx.drawImage(image, 0, 0);
                        originalImagePixels = tempCtx.getImageData(0, 0, image.width, image.height);

                        applyAllChanges();
                    };
                    image.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });

            // OPTIMIZATION: Use 'input' for fast previews and 'change' for final, high-quality renders.
            editorControls.addEventListener('input', (e) => {
                if (e.target.type === 'range') {
                    // 1. Update state and UI text value
                    const [group, prop] = e.target.id.split(/-(.+)/);
                    if (state[group]) {
                        state[group][prop] = parseFloat(e.target.value);
                    }
                    document.getElementById(`${e.target.id}-value`).textContent = e.target.value + (e.target.id.includes('blur') ? 'px' : e.target.id.includes('vibrance') || e.target.id.includes('saturation') || e.target.id.includes('exposure') || e.target.id.includes('brightness') || e.target.id.includes('contrast')? '%' : '');
                    
                    // 2. Apply the fast, GPU-accelerated preview render
                    requestAnimationFrame(applyFastPreview);
                }
            });

            editorControls.addEventListener('change', (e) => {
                if (e.target.type === 'range') {
                    // When the user releases the slider, apply the full, accurate render
                    applyAllChanges();
                }
            });

            // Filter and Transform buttons apply the full change immediately
            editorControls.addEventListener('click', (e) => {
                const target = e.target.closest('button');
                if (!target || target.type !== 'button') return;
                
                if (target.classList.contains('filter-btn')) {
                    state.filter = target.dataset.filter;
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('btn-primary', 'btn-secondary'));
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.add('btn-secondary'));
                    target.classList.remove('btn-secondary');
                    target.classList.add('btn-primary');
                } else {
                    switch(target.id) {
                        case 'rotate-left-btn': state.transform.rotation -= 90; break;
                        case 'rotate-right-btn': state.transform.rotation += 90; break;
                        case 'flip-horizontal-btn': state.transform.flipH *= -1; break;
                        case 'flip-vertical-btn': state.transform.flipV *= -1; break;
                    }
                }
                applyAllChanges();
            });

            // Header buttons
            document.getElementById('reset-btn').addEventListener('click', () => {
                if (!image) return;
                resetState();
                applyAllChanges();
            });

            document.getElementById('download-btn').addEventListener('click', () => {
                if (!image) return;
                const link = document.createElement('a');
                link.download = 'edited-photo.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
            
            // --- Core Functions ---

            function resetState() {
                state = JSON.parse(JSON.stringify(defaultState));
                // Update UI sliders and values
                for (const group in state) {
                    if (typeof state[group] === 'object' && state[group] !== null) {
                        for (const prop in state[group]) {
                            const sliderId = `${group}-${prop}`;
                            const slider = document.getElementById(sliderId);
                            if (slider) {
                                slider.value = state[group][prop];
                                const valueEl = document.getElementById(`${slider.id}-value`);
                                if (valueEl) valueEl.textContent = slider.value + (slider.id.includes('blur') ? 'px' : slider.id.includes('vibrance') || slider.id.includes('saturation')|| slider.id.includes('exposure') || slider.id.includes('brightness') || slider.id.includes('contrast') ? '%' : '');
                            }
                        }
                    }
                }
                 document.querySelectorAll('.filter-btn').forEach(b => {
                    b.classList.remove('btn-primary');
                    b.classList.add('btn-secondary');
                    if (b.dataset.filter === 'none') {
                        b.classList.add('btn-primary');
                        b.classList.remove('btn-secondary');
                    }
                });
            }
            
            /**
             * NEW: Fast, real-time preview using only GPU-accelerated CSS filters.
             * This function is called while sliders are being moved.
             */
            function applyFastPreview() {
                if (!image) return;

                const isSideways = Math.abs(state.transform.rotation % 180) === 90;
                canvas.width = isSideways ? image.height : image.width;
                canvas.height = isSideways ? image.width : image.height;

                // Combine all fast, GPU-accelerated filters.
                // Note: slow effects like Temperature, Tint, Vibrance, and pixel-based filters
                // are intentionally excluded from this live preview for performance.
                let filterString = `
                    brightness(${state.light.exposure / 100}) 
                    brightness(${state.light.brightness / 100}) 
                    contrast(${state.light.contrast / 100}) 
                    saturate(${state.color.saturation / 100})
                    blur(${state.effects.blur}px)
                    contrast(${1 + (state.effects.clarity / 200)}) 
                `;

                switch(state.filter) {
                    case 'grayscale': filterString += ' grayscale(100%)'; break;
                    case 'sepia': filterString += ' sepia(100%)'; break;
                    case 'invert': filterString += ' invert(100%)'; break;
                }
                
                ctx.filter = filterString;
                
                // Draw image with transforms
                ctx.save();
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(state.transform.rotation * Math.PI / 180);
                ctx.scale(state.transform.flipH, state.transform.flipV);
                ctx.drawImage(image, -image.width / 2, -image.height / 2);
                ctx.restore();
                
                // The filter remains on the context for the preview. The next full render will reset it.
                applyVignette();
            }

            /**
             * The full, high-quality render. Called on slider release and button clicks.
             */
            function applyAllChanges() {
                if (!image || !originalImagePixels) return;

                const isSideways = Math.abs(state.transform.rotation % 180) === 90;
                canvas.width = isSideways ? image.height : image.width;
                canvas.height = isSideways ? image.width : image.height;
                
                // 1. Apply base CSS filters
                let filterString = `
                    brightness(${state.light.exposure / 100}) 
                    brightness(${state.light.brightness / 100}) 
                    contrast(${state.light.contrast / 100}) 
                    saturate(${state.color.saturation / 100})
                    blur(${state.effects.blur}px)`;
                
                switch(state.filter) {
                    case 'grayscale': filterString += ' grayscale(100%)'; break;
                    case 'sepia': filterString += ' sepia(100%)'; break;
                    case 'invert': filterString += ' invert(100%)'; break;
                }
                
                ctx.filter = filterString;
                
                // 2. Apply transformations
                ctx.save();
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(state.transform.rotation * Math.PI / 180);
                ctx.scale(state.transform.flipH, state.transform.flipV);
                ctx.drawImage(image, -image.width / 2, -image.height / 2);
                ctx.restore();
                ctx.filter = 'none'; // Reset filter before pixel manipulation

                // 3. Apply slow, high-quality pixel adjustments
                applyPixelAdjustments();

                // 4. Apply overlays
                applyVignette();
            }

            function applyPixelAdjustments() {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                const temp = state.color.temperature / 100;
                const tint = state.color.tint / 100;
                const vibrance = state.color.vibrance / 100;
                const clarity = state.effects.clarity / 100;
                const lomo = state.filter === 'lomo';
                const vintage = state.filter === 'vintage';
                
                for (let i = 0; i < data.length; i += 4) {
                    let r = data[i], g = data[i+1], b = data[i+2];

                    if (temp !== 0) { r += 255 * temp; b -= 255 * temp; }
                    if (tint !== 0) { g += 255 * tint; }
                    if (vibrance !== 1) {
                        const max = Math.max(r, g, b);
                        const avg = (r + g + b) / 3;
                        const amt = ((Math.abs(max - avg) * 2 / 255) * (vibrance - 1));
                        if (r !== max) r += (max - r) * amt;
                        if (g !== max) g += (max - g) * amt;
                        if (b !== max) b += (max - b) * amt;
                    }
                    if (clarity > 0) {
                        r = 127.5 + (1 - clarity) * (r - 127.5);
                        g = 127.5 + (1 - clarity) * (g - 127.5);
                        b = 127.5 + (1 - clarity) * (b - 127.5);
                    }
                    if (lomo) { r *= 1.1; g *= 1.1; b *= 0.9; }
                    if (vintage) { r *= 0.9; g *= 0.85; b *= 0.7; }
                    
                    data[i] = Math.max(0, Math.min(255, r));
                    data[i+1] = Math.max(0, Math.min(255, g));
                    data[i+2] = Math.max(0, Math.min(255, b));
                }
                ctx.putImageData(imageData, 0, 0);
            }

            function applyVignette() {
                const amount = state.effects.vignette;
                const size = 100 - amount;
                const darkness = amount / 100 * 0.7;
                let shadow = `inset 0 0 ${size}px ${size}px rgba(0,0,0,${darkness})`;

                if (state.filter === 'lomo' || state.filter === 'vintage') {
                    shadow = `inset 0 0 80px 80px rgba(0,0,0,0.5)`;
                }
                vignetteOverlay.style.boxShadow = shadow;
            }

            // Initial page load setup
            function init() {
                document.getElementById('reset-btn').disabled = true;
                document.getElementById('download-btn').disabled = true;
                // Add class for styling slider controls
                document.querySelectorAll('.control-wrap').forEach(wrap => {
                    const label = wrap.querySelector('label');
                    const valueSpan = wrap.querySelector('span');
                    wrap.classList.add('flex', 'items-center', 'space-x-3');
                    label.classList.add('w-24', 'text-sm', 'text-text-light');
                    valueSpan.classList.add('text-xs', 'bg-dark-bg', 'px-2', 'py-1', 'rounded', 'w-16', 'text-center');
                });
            }
            
            init();
        });
    </script>
</body>
</html>
